(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-msg-msg"],{1923:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("cu-custom",{attrs:{bgColor:"bg-gradual-blue",isBack:!1}},[i("template",{attrs:{slot:"content"},slot:"content"},[t._v("消息")])],2),i("v-uni-view",{staticClass:"cu-list menu-avatar"},[t._l(t.msgList,function(e,n){return[t.my_uid!=e.from_id?i("v-uni-view",{staticClass:"cu-item",class:t.modalName=="move-box-"+n?"move-cur":"",attrs:{"data-target":"move-box-"+n},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchStart.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchEnd.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"cu-avatar round lg",style:[{backgroundImage:"url("+e.from_face+")"}],on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.MsgChat(e.from_id)}}},[i("v-uni-view",{staticClass:"cu-tag badge"},[t._v(t._s(e.number?e.number:1))])],1),i("v-uni-view",{staticClass:"content"},[i("v-uni-view",{staticClass:"text-grey"},[t._v(t._s(e.from_nickrname))]),i("v-uni-view",{staticClass:"text-gray text-sm"},[t._v(t._s(e.data))])],1),i("v-uni-view",{staticClass:"action"},[i("v-uni-view",{staticClass:"text-grey text-xs"},[t._v(t._s(e.time))])],1),i("v-uni-view",{staticClass:"move"},[i("v-uni-view",{staticClass:"bg-red"},[t._v("删除")])],1)],1):t._e(),t.my_uid==e.from_id?i("v-uni-view",{staticClass:"cu-item",class:t.modalName=="move-box-"+n?"move-cur":"",attrs:{"data-target":"move-box-"+n},on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchStart.apply(void 0,arguments)},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.ListTouchEnd.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"cu-avatar round lg",style:[{backgroundImage:"url("+e.to_face+")"}],on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.MsgChat(e.to_id)}}}),i("v-uni-view",{staticClass:"content"},[i("v-uni-view",{staticClass:"text-grey"},[t._v(t._s(e.to_nickrname))]),i("v-uni-view",{staticClass:"text-gray text-sm"},[t._v(t._s(e.data))])],1),i("v-uni-view",{staticClass:"action"},[i("v-uni-view",{staticClass:"text-grey text-xs"},[t._v(t._s(e.time))])],1),i("v-uni-view",{staticClass:"move"},[i("v-uni-view",{staticClass:"bg-red"},[t._v("删除")])],1)],1):t._e()]})],2),i("v-uni-view",{staticClass:"page-footer"})],1)},s=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return s})},"2e3c":function(t,e,i){"use strict";i.r(e);var n=i("1923"),s=i("b95f");for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);var o=i("2877"),c=Object(o["a"])(s["default"],n["a"],n["b"],!1,null,"6db8deb1",null);e["default"]=c.exports},"83e0":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("ac6a");var n={data:function(){return{modalName:null,listTouchStart:0,listTouchDirection:null,connectSocket:!1,msgList:[],my_uid:0,to_id:3,content:""}},computed:{},mounted:function(){this.onSocketConnect()},methods:{ListTouchStart:function(t){this.listTouchStart=t.touches[0].pageX},ListTouchMove:function(t){this.listTouchDirection=t.touches[0].pageX-this.listTouchStart>0?"right":"left"},ListTouchEnd:function(t){"left"==this.listTouchDirection?this.modalName=t.currentTarget.dataset.target:this.modalName=null,this.listTouchDirection=null},MsgChat:function(t){uni.navigateTo({url:"../chat/chat?from_id="+t})},onSocketMessage:function(t){var e=t;try{switch(e=JSON.parse(t.data),console.log("收到服务器内容：",e),e.type){case"connect":console.log("client_id：",e.client_id),this.bindUid(e.client_id);break;case"text":this.setMsgList(e);break;default:break}}catch(i){}},bindUid:function(t){var e=this.fun.getUser();uni.request({url:this.api.bind_uid,header:{token:e[2]},method:"POST",data:{uid:e[0],client_id:t},success:function(t){console.log(t.data)},fail:this.fun.fail})},sendMsg:function(){var t=this.fun.getUser();uni.request({url:this.api.send_msg,header:{token:t[2]},method:"POST",data:{to_id:this.to_id,from_id:t[0],from_face:t[4],from_nickrname:t[1],type:"text",data:this.content,number:1},success:function(t){t.data.error<0&&uni.showToast({title:t.data.msg,icon:"none"})},fail:this.fun.fail})},setMsgList:function(t){var e=this.inArray(t,this.msgList);if(e||0!=this.msgList.length){var i=this.msgList[e],n=i.number?i.number:1;i.number=n+1,i.data=t.data,i.time=t.time,this.msgList[e]=i}else this.msgList.push(t)},inArray:function(t,e){var i=!1;return e.forEach(function(e,n){e.from_id==t.from_id&&e.to_id==t.to_id&&(i=n)}),i},sumNumber:function(t){var e=0;return t.forEach(function(t){e+=t.number}),e},getMyList:function(){var t=this,e=this.fun.getUser();this.my_uid=e[0],uni.request({url:this.api.get_my_list,header:{token:e[2]},method:"POST",data:{to_id:e[0]},success:function(e){console.log(e.data),e.data.error<0&&uni.showToast({title:e.data.msg,icon:"none"}),t.msgList=e.data.data},fail:this.fun.fail})},onSocketConnect:function(){this.connectSocket||(this.connectSocket=uni.connectSocket({url:this.api.socket}),uni.onSocketOpen(function(t){console.log("WebSocket连接已打开！"),uni.sendSocketMessage({data:"msg",type:"text"})}),uni.onSocketError(function(t){console.log("WebSocket连接打开失败，请检查！")}),uni.onSocketMessage(this.onSocketMessage)),this.getMyList()}}};e.default=n},b95f:function(t,e,i){"use strict";i.r(e);var n=i("83e0"),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=s.a}}]);